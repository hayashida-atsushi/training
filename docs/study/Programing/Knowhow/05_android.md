# Android Activity(アクティビティ)のライフサイクル

## なぜ書いているか

Android アプリの開発の中でアクティビティのライフサイクルに苦労したため。<br/>
Android のライフサイクルに関するコールバックメソッドの使い方をまとめる。

## そもそも Activity(アクティビティ)とは

[Android 公式](https://developer.android.com/guide/components/activities/intro-activities?hl=ja)によると、アプリが他のアプリを呼び出す際にアプリ全体ではなく、アクティビティを呼び出す、そして、ユーザーとアプリのやり取りの起点(エントリーポイント)になると記載されている。<br/>
要は**ユーザー操作を受け付けるまとまり**である。<br/>(公式以外の様々なサイトでは画面と記載されていることが多い。実際公式も、一般的には 1 アクティビティに対し 1 つの画面を実装すると記載している。)<br/>
このアクティビティは他のアクティビティを呼び出したりするなど、連携することができるが、その際にきちんと生成・破棄を行わないと予期せぬ挙動につながる。これをライフサイクルの中できちんと管理するのが重要である。

## ライフサイクル

ユーザーの操作によってアプリの内外を行き来すると、アクティビティは様々な状態を遷移する。その状態に応じて、どのような挙動を行うかはコールバックメソッドの中で定義しないといけない。<br/>
以下の図はそのアクティビティとライフサイクルについての遷移図で、公式から引用している。コールバックメソッドについて、代表的なものを紹介する。<br/>
![Androidのアクティビティライフサイクル](../../../../static/img/activity_lifecycle.png)

- onCreate()
  - アクティビティが作成された最初の 1 回のみ呼ばれる。
  - アクティビティが破棄されない限り、初回以外で実行されない。
  - アプリの基本的な起動ロジックや初期設定などを行う。(画面(View)の取得、リストへのデータ格納やアニメーションの設定など)
- onStart()
  - アクティビティが開始状態になると呼ばれる。
  - フォアグラウンドにアクティビティが遷移しつつ、ユーザー操作を受けつける手前の状態。
  - 画面の構成要素への初期設定や必要なリソースの割り当てを行う。(View にイベントを登録する、カメラ起動や位置情報の取得など)
- onResume()
  - アクティビティがフォアグラウンドに遷移した状態になると呼ばれる。
  - ユーザー操作を受けつけ始める状態。
  - UI の更新、ユーザー操作を受けつけるための処理を行う。(リアルタイムデータの更新や、音楽の再開など)
- onPause()
  - アクティビティが一時停止しようとすると呼ばれる。
  - バックグラウンドへ遷移し始める状態。
  - 一時的に状態を保存しておく処理を行うが、非常に短期間で終了するため、アプリデータやユーザーデータの保存は行わない。
- onStop()
  - アクティビティがバックグラウンドに遷移したときに呼ばれる。
  - ユーザーからアクティビティが確認できなくなった状態。
  - アニメーションの一時停止など、アプリデータやユーザーデータの保存やネットワークの呼び出しを行う。
- onDestroy()
  - アクティビティが破棄される直前に呼ばれる。
  - アクティビティが破棄されようとしている状態。
  - onStop までに解除できていないリソースの解除を行う。

## 参考

- https://developer.android.com/guide/components/activities/Activity-lifecycle?hl=ja
