"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[1643],{3469:(n,r,e)=>{e.r(r),e.d(r,{assets:()=>d,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>l});var a=e(4848),t=e(8453);const o={},i="\u74b0\u5883\u5dee\u7570\u306b\u3088\u308b terraform \u5dee\u5206\u306e\u89e3\u6d88\u65b9\u6cd5",s={id:"study/Programing/Knowhow/terraform",title:"\u74b0\u5883\u5dee\u7570\u306b\u3088\u308b terraform \u5dee\u5206\u306e\u89e3\u6d88\u65b9\u6cd5",description:"\u306a\u305c\u66f8\u3044\u3066\u3044\u308b\u304b",source:"@site/docs/study/Programing/Knowhow/09_terraform.md",sourceDirName:"study/Programing/Knowhow",slug:"/study/Programing/Knowhow/terraform",permalink:"/training/docs/study/Programing/Knowhow/terraform",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedAt:1743416353e3,sidebarPosition:9,frontMatter:{},sidebar:"study",previous:{title:"\u76ee\u6a19\u8a2d\u5b9a\u3084\u8a55\u4fa1\u306e\u66f8\u5f0f(\u81ea\u5206\u7528\u30e1\u30e2)",permalink:"/training/docs/study/Programing/Knowhow/target-settings"},next:{title:"node_modules\u306e\u624b\u52d5\u4fee\u6b63\u3068\u305d\u306e\u5c55\u958b\u65b9\u6cd5\u306b\u3064\u3044\u3066\ud83d\udd30",permalink:"/training/docs/study/Programing/Knowhow/node_modules"}},d={},l=[{value:"\u306a\u305c\u66f8\u3044\u3066\u3044\u308b\u304b",id:"\u306a\u305c\u66f8\u3044\u3066\u3044\u308b\u304b",level:2},{value:"\u30ed\u30b0",id:"\u30ed\u30b0",level:2},{value:"\u539f\u56e0\u30fb\u5bfe\u7b56",id:"\u539f\u56e0\u5bfe\u7b56",level:2},{value:"\u53c2\u8003",id:"\u53c2\u8003",level:2}];function c(n){const r={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...n.components},{Details:e}=r;return e||function(n,r){throw new Error("Expected "+(r?"component":"object")+" `"+n+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.h1,{id:"\u74b0\u5883\u5dee\u7570\u306b\u3088\u308b-terraform-\u5dee\u5206\u306e\u89e3\u6d88\u65b9\u6cd5",children:"\u74b0\u5883\u5dee\u7570\u306b\u3088\u308b terraform \u5dee\u5206\u306e\u89e3\u6d88\u65b9\u6cd5"}),"\n",(0,a.jsx)(r.h2,{id:"\u306a\u305c\u66f8\u3044\u3066\u3044\u308b\u304b",children:"\u306a\u305c\u66f8\u3044\u3066\u3044\u308b\u304b"}),"\n",(0,a.jsxs)(r.p,{children:["PJ \u3067\u5909\u66f4\u304c\u306a\u3044\u306b\u3082\u95a2\u308f\u3089\u305a\u3001",(0,a.jsx)(r.code,{children:"terraform plan"}),"\u5b9f\u884c\u6642\u306b\u4f59\u8a08\u306a\u5dee\u5206\u304c\u767a\u751f\u3057\u3066\u3057\u307e\u3063\u3066\u3044\u305f\u3002\u3053\u306e\u5dee\u5206\u306e\u89e3\u6d88\u65b9\u6cd5\u306b\u95a2\u3057\u3066\u30e1\u30e2\u3057\u3066\u304a\u304f\u305f\u3081\u3002"]}),"\n",(0,a.jsx)(r.h2,{id:"\u30ed\u30b0",children:"\u30ed\u30b0"}),"\n",(0,a.jsx)(r.p,{children:"\u4ee5\u4e0b\u304c\u30ed\u30b0"}),"\n",(0,a.jsxs)(e,{children:[(0,a.jsx)("summary",{children:"\u5168\u6587\u3092\u8868\u793a"}),(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{children:'...\u5dee\u5206\u591a\u3044\u306e\u3067\u9069\u5f53\u306b\u7701\u7565\r\n# data.aws_iam_policy_document.XXXXwill be read during apply\r\n  # (depends on a resource or a module with changes pending)\r\n <= data "aws_iam_policy_document" "XXXX" {\r\n      + id   = (known after apply)\r\n      + json = (known after apply)\r\n\r\n      + statement {\r\n          + actions   = [\r\n              + "s3:GetObject",\r\n            ]\r\n          + effect    = "Allow"\r\n          + resources = [\r\n              + "arn:aws:s3:::XXXX",\r\n              + "arn:aws:s3:::XXXX/*",\r\n            ]\r\n          + sid       = "Allow CloudFront"\r\n\r\n          + condition {\r\n              + test     = "StringEquals"\r\n              + values   = [\r\n                  + "arn:aws:cloudfront::XXXXX",\r\n                ]\r\n              + variable = "aws:SourceArn"\r\n            }\r\n\r\n          + principals {\r\n              + identifiers = [\r\n                  + "cloudfront.amazonaws.com",\r\n                ]\r\n              + type        = "Service"\r\n            }\r\n        }\r\n    }\r\n\r\n# aws_cloudfront_distribution.XXXXX-cfd will be updated in-place\r\n\r\n~ resource "aws_cloudfront_distribution" "XXXXXXX-cfd" {\r\nid = "XXXXXXXX"\r\ntags = {\r\n"Name" = "XXXXXX-cfd"\r\n"company" = "XXXX"\r\n"environment_type" = "dev"\r\n"project_name" = "XXXX XXXX"\r\n"source_by" = "terraform"\r\n} # (21 unchanged attributes hidden)\r\n\r\n      ~ default_cache_behavior {\r\n            # (12 unchanged attributes hidden)\r\n\r\n          - lambda_function_association {\r\n              - event_type   = "viewer-request" -> null\r\n              - include_body = true -> null\r\n              - lambda_arn   = "arn:aws:lambda:us-east-1:XXXXX" -> null\r\n            }\r\n          + lambda_function_association {\r\n              + event_type   = "viewer-request"\r\n              + include_body = true\r\n              + lambda_arn   = (known after apply)\r\n            }\r\n        }\r\n\r\n      ~ ordered_cache_behavior {\r\n            # (13 unchanged attributes hidden)\r\n\r\n          - lambda_function_association {\r\n              - event_type   = "viewer-request" -> null\r\n              - include_body = true -> null\r\n              - lambda_arn   = "arn:aws:lambda:us-east-1:XXXXXX" -> null\r\n            }\r\n          + lambda_function_association {\r\n              + event_type   = "viewer-request"\r\n              + include_body = true\r\n              + lambda_arn   = (known after apply)\r\n            }\r\n        }\r\n      ~ ordered_cache_behavior {\r\n            # (13 unchanged attributes hidden)\r\n\r\n          - lambda_function_association {\r\n              - event_type   = "viewer-request" -> null\r\n              - include_body = true -> null\r\n              - lambda_arn   = "arn:aws:lambda:us-east-1:XXXXX" -> null\r\n            }\r\n          + lambda_function_association {\r\n              + event_type   = "viewer-request"\r\n              + include_body = true\r\n              + lambda_arn   = (known after apply)\r\n            }\r\n        }\r\n      ~ ordered_cache_behavior {\r\n            # (13 unchanged attributes hidden)\r\n\r\n          - lambda_function_association {\r\n              - event_type   = "viewer-request" -> null\r\n              - include_body = true -> null\r\n              - lambda_arn   = "arn:aws:lambda:us-east-1:XXXXX" -> null\r\n            }\r\n          + lambda_function_association {\r\n              + event_type   = "viewer-request"\r\n              + include_body = true\r\n              + lambda_arn   = (known after apply)\r\n            }\r\n        }\r\n      ~ ordered_cache_behavior {\r\n            # (13 unchanged attributes hidden)\r\n\r\n          - lambda_function_association {\r\n              - event_type   = "viewer-request" -> null\r\n              - include_body = true -> null\r\n              - lambda_arn   = "arn:aws:lambda:us-east-1:XXXXXX" -> null\r\n            }\r\n          + lambda_function_association {\r\n              + event_type   = "viewer-request"\r\n              + include_body = true\r\n              + lambda_arn   = (known after apply)\r\n            }\r\n        }\r\n      ~ ordered_cache_behavior {\r\n            # (13 unchanged attributes hidden)\r\n\r\n          - lambda_function_association {\r\n              - event_type   = "viewer-request" -> null\r\n              - include_body = true -> null\r\n              - lambda_arn   = "arn:aws:lambda:us-east-1:XXXXX" -> null\r\n            }\r\n          + lambda_function_association {\r\n              + event_type   = "viewer-request"\r\n              + include_body = true\r\n              + lambda_arn   = (known after apply)\r\n            }\r\n        }\r\n\r\n        # (7 unchanged blocks hidden)\r\n    }\r\n\r\n\r\n# aws_lambda_function.tp-dynamodb-streams will be updated in-place\r\n\r\n~ resource "aws_lambda_function" "tp-dynamodb-streams" {\r\nid = "tp-dev-dynamodb-streams"\r\n~ last_modified = "2023-10-02T02:09:29.000+0000" -> (known after apply)\r\n~ qualified_arn = "arn:aws:lambda:ap-northeast-1:XXXXXX" -> (known after apply)\r\n~ qualified_invoke_arn = "arn:aws:apigateway:ap-northeast-1:lambda:path/2015-03-31/functions/arn:aws:lambda:ap-northeast-1:XXXXXX" -> (known after apply)\r\n~ source_code_hash = "AAAAAA" -> "BBBBB"\r\ntags = {\r\n"Name" = "tp-dynamodb-streams"\r\n"company" = "XXXX"\r\n"environment_type" = "dev"\r\n"project_name" = "XXXX XXXX"\r\n"source_by" = "terraform"\r\n}\r\n~ version = "29" -> (known after apply) # (16 unchanged attributes hidden)\r\n\r\n        # (4 unchanged blocks hidden)\r\n    }\r\n\r\n# aws_s3_bucket_policy.XXXXX will be updated in-place\r\n\r\n~ resource "aws_s3_bucket_policy" "XXXXX" {\r\nid = "XXXXX"\r\n~ policy = jsonencode(\r\n{ - Statement = [ - { - Action = "s3:GetObject" - Condition = { - StringEquals = { - "aws:SourceArn" = "arn:aws:cloudfront::XXXXXX"\r\n}\r\n} - Effect = "Allow" - Principal = { - Service = "cloudfront.amazonaws.com"\r\n} - Resource = [\r\n\r\n- "arn:aws:s3:::XXXXXXX/\\*",\r\n- "arn:aws:s3:::XXXXXXX",\r\n  ] - Sid = "Allow CloudFront"\r\n  },\r\n  ] - Version = "2012-10-17"\r\n  }\r\n  ) -> (known after apply) # (1 unchanged attribute hidden)\r\n  }\r\n\r\n# aws_s3_bucket_policy.XXXXXX will be updated in-place\r\n\r\n~ resource "aws_s3_bucket_policy" "XXXXX" {\r\nid = "XXXXX"\r\n~ policy = jsonencode(\r\n{ - Statement = [ - { - Action = "s3:GetObject" - Condition = { - StringEquals = { - "aws:SourceArn" = "arn:aws:cloudfront::XXXXXX"\r\n}\r\n} - Effect = "Allow" - Principal = { - Service = "cloudfront.amazonaws.com"\r\n} - Resource = [\r\n\r\n- "arn:aws:s3:::XXXX/\\*",\r\n- "arn:aws:s3:::XXXX",\r\n  ] - Sid = "Allow CloudFront"\r\n  },\r\n  ] - Version = "2012-10-17"\r\n  }\r\n  ) -> (known after apply) # (1 unchanged attribute hidden)\r\n  }\r\n\n'})})]}),"\n",(0,a.jsx)(r.p,{children:"\u3053\u308c\u3092\u898b\u308b\u3068\u3001lambda \u306e sourceCodeHash \u304c\u5909\u308f\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u539f\u56e0\u306e\u69d8\u3060\u3063\u305f\u3002"}),"\n",(0,a.jsx)(r.h2,{id:"\u539f\u56e0\u5bfe\u7b56",children:"\u539f\u56e0\u30fb\u5bfe\u7b56"}),"\n",(0,a.jsxs)(r.p,{children:["\u306a\u3093\u3067\u5909\u308f\u3063\u305f\u304b\u3001\u3053\u306e sourceCodeHash \u306f\u3069\u306e\u3088\u3046\u306b\u53d6\u5f97\u3057\u3066\u3044\u308b\u304b\u3068\u3044\u3046\u3068\u3001lambda \u306e\u30b3\u30fc\u30c9(\u4eca\u56de\u306f.js)\u3092 zip \u5316\u3057\u3066\u304b\u3089 hash \u3092\u53d6\u5f97\u3057\u3066\u3044\u308b\u3089\u3057\u3044(archive_file)\u304c\u3001",(0,a.jsx)("br",{}),"\r\nzip \u5316\u3057\u305f\u5f8c\u306e permission \u304c OS \u306b\u3088\u3063\u3066\u3001\u7570\u306a\u308b\u305f\u3081\u306b\u767a\u751f\u3057\u3066\u3044\u308b\u3089\u3057\u3044\u3002\u307e\u305f\u3001\u305d\u308c\u306b\u52a0\u3048\u3066\u3001.js \u306e\u6539\u884c\u30b3\u30fc\u30c9\u3082\u7d71\u4e00\u3055\u308c\u3066\u3044\u306a\u3044\u305f\u3081\u306b\u3001\u7570\u306a\u308b sourceCodeHash \u304c\u751f\u6210\u3055\u308c\u3066\u3044\u305f\u6a21\u69d8\u3002"]}),"\n",(0,a.jsx)("br",{}),"\n",(0,a.jsx)(r.p,{children:"lambda \u4ee5\u5916\u306e\u5dee\u5206\u306f lambda \u306e sourceCodeHash \u306e\u5909\u66f4\u306b\u5f15\u3063\u5f35\u3089\u308c\u305f\u3082\u306e\u3067\u3042\u3063\u305f\u3002"}),"\n",(0,a.jsx)("br",{}),"\n",(0,a.jsx)(r.p,{children:"\u3053\u306e\u305f\u3081\u3001\u8a72\u5f53\u306e.tf \u30d5\u30a1\u30a4\u30eb\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a18\u8f09\u3057\u3001\u5404.js \u30d5\u30a1\u30a4\u30eb\u306e\u6539\u884c\u30b3\u30fc\u30c9\u3092\u7d71\u4e00\u3057\u305f(LF \u3067\u904b\u7528\u3059\u308b\u3088\u3046\u306b\u3057\u305f)\u3002"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-tf",metastring:'title="lambda.tf"',children:'data "archive_file" "lambda" {\r\n  type        = "zip"\r\n  source_file = "lambda.js"\r\n  output_path = "lambda_XXXX.zip"\r\n+  output_file_mode = "0644"\r\n}\n'})}),"\n",(0,a.jsx)(r.h2,{id:"\u53c2\u8003",children:"\u53c2\u8003"}),"\n",(0,a.jsx)(r.p,{children:"\u7b2c\u4e00\u30bd\u30fc\u30b9\u306b\u3064\u3044\u3066\u898b\u5931\u3063\u305f\u305f\u3081\u3001\u898b\u3064\u3051\u6b21\u7b2c\u8a18\u8f09\u4e88\u5b9a\u3002"}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsx)(r.li,{children:(0,a.jsx)(r.a,{href:"https://zenn.dev/ikedam/articles/b98cb1acbb15de",children:"https://zenn.dev/ikedam/articles/b98cb1acbb15de"})}),"\n"]})]})}function u(n={}){const{wrapper:r}={...(0,t.R)(),...n.components};return r?(0,a.jsx)(r,{...n,children:(0,a.jsx)(c,{...n})}):c(n)}},8453:(n,r,e)=>{e.d(r,{R:()=>i,x:()=>s});var a=e(6540);const t={},o=a.createContext(t);function i(n){const r=a.useContext(o);return a.useMemo((function(){return"function"==typeof n?n(r):{...r,...n}}),[r,n])}function s(n){let r;return r=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:i(n.components),a.createElement(o.Provider,{value:r},n.children)}}}]);